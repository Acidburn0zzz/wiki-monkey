// Generated by CoffeeScript 1.12.7
var CSS, DOM;

CSS = require('../../lib.js.generic/dist/CSS');

DOM = require('../../lib.js.generic/dist/DOM');

module.exports.ArchWikiNPFilter = (function() {
  ArchWikiNPFilter.REQUIRES_GM = false;

  function ArchWikiNPFilter(WM) {
    this.WM = WM;
  }

  ArchWikiNPFilter.prototype.main = function(params) {
    var contentDiv, i, insertMark, j, len, len1, li, liList, link, links, title, ul;
    CSS.addStyleElement("#mw-content-text > h5 {background-color:#afa;}");
    contentDiv = document.getElementById('mw-content-text');
    ul = contentDiv.getElementsByTagName('ul')[0];
    liList = DOM.getChildrenByTagName(ul, 'li');
    insertMark = ul.nextSibling;
    for (i = 0, len = liList.length; i < len; i++) {
      li = liList[i];
      links = li.getElementsByTagName('a');
      for (j = 0, len1 = links.length; j < len1; j++) {
        link = links[j];
        if (link.className === 'mw-newpages-pagename') {
          title = link.title;
          this.WM.Plugins.ArchWikiNPFilter.moveArticle(params, contentDiv, insertMark, li, title);
          break;
        }
      }
    }
    return this.WM.Log.logInfo("Grouped articles by language");
  };

  ArchWikiNPFilter.prototype.moveArticle = function(params, contentDiv, insertMark, li, title) {
    var HLang, i, lang, langFound, langH, langHs, language, len, pureTitle, ul;
    lang = this.WM.ArchWiki.detectLanguage(title);
    pureTitle = lang[0];
    language = lang[1];
    if (language !== params.language) {
      langHs = DOM.getChildrenByTagName(contentDiv, 'h5');
      langFound = false;
      for (i = 0, len = langHs.length; i < len; i++) {
        HLang = langHs[i];
        if (HLang.innerHTML === language) {
          ul = DOM.getNextElementSibling(HLang);
          ul.appendChild(li);
          langFound = true;
          break;
        }
      }
      if (!langFound) {
        langH = document.createElement('h5');
        langH.innerHTML = language;
        ul = document.createElement('ul');
        contentDiv.insertBefore(langH, insertMark);
        contentDiv.insertBefore(ul, insertMark);
        return ul.appendChild(li);
      }
    }
  };

  return ArchWikiNPFilter;

})();
