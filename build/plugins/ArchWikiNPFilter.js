// Generated by CoffeeScript 1.12.7
var $, CSS;

$ = require('jquery');

CSS = require('../../lib.js.generic/dist/CSS');

module.exports.ArchWikiNPFilter = (function() {
  ArchWikiNPFilter.REQUIRES_GM = false;

  function ArchWikiNPFilter(WM) {
    this.WM = WM;
  }

  ArchWikiNPFilter.prototype.main = function(params) {
    var contentDiv, i, language, len, li, liList, link, pureTitle, ref, ul;
    CSS.addStyleElement("#mw-content-text > h5 {background-color:#afa;}");
    contentDiv = $('#mw-content-text');
    ul = contentDiv.find('ul').first();
    liList = ul.children('li');
    for (i = 0, len = liList.length; i < len; i++) {
      li = liList[i];
      link = $(li).find('a.mw-newpages-pagename').first();
      ref = this.WM.ArchWiki.detectLanguage(link[0].title), pureTitle = ref[0], language = ref[1];
      if (language !== params.language) {
        this.WM.Plugins.ArchWikiNPFilter.moveArticle(contentDiv, li, language);
      }
    }
    return this.WM.Log.logInfo("Grouped articles by language");
  };

  ArchWikiNPFilter.prototype.moveArticle = function(contentDiv, li, language) {
    var HLang, i, langFound, langHs, len, ul;
    langHs = contentDiv.children('h5');
    langFound = false;
    for (i = 0, len = langHs.length; i < len; i++) {
      HLang = langHs[i];
      if (HLang.innerHTML === language) {
        ul = $(HLang).next().append(li);
        langFound = true;
        break;
      }
    }
    if (!langFound) {
      return contentDiv.append($('<h5>').text(language), $('<ul>').append(li));
    }
  };

  return ArchWikiNPFilter;

})();
